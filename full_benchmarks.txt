[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m

 RUN  v2.1.9 /Users/liorshtram/dev/dream-news/.worktrees/ingestion-pipeline-v1

stdout | src/lib/pipeline/stages/01_discovery.integration.test.ts > Stage 1: Bulk Discovery (Integration) > should fetch real items from multiple RSS feeds
[Test] Fetching from 4 sources...
[RssConnector] Fetching: https://news.ycombinator.com/rss
[RssConnector] Fetching: https://techcrunch.com/feed
[RssConnector] Fetching: https://www.theverge.com/rss/index.xml
[RssConnector] Fetching: https://www.wired.com/feed/rss

stdout | src/lib/pipeline/stages/01_discovery.integration.test.ts > Stage 1: Bulk Discovery (Integration) > should fetch real items from multiple RSS feeds
[RssConnector] Parsed 50 items from Wired

stdout | src/lib/pipeline/stages/01_discovery.integration.test.ts > Stage 1: Bulk Discovery (Integration) > should fetch real items from multiple RSS feeds
[RssConnector] Parsed 10 items from The Verge

stdout | src/lib/pipeline/stages/01_discovery.integration.test.ts > Stage 1: Bulk Discovery (Integration) > should fetch real items from multiple RSS feeds
[RssConnector] Parsed 20 items from TechCrunch

stdout | src/lib/pipeline/stages/01_discovery.integration.test.ts > Stage 1: Bulk Discovery (Integration) > should fetch real items from multiple RSS feeds
[RssConnector] Parsed 30 items from Hacker News
[Test] Discovered 110 total items in 912.92ms.
[Stats] Performance: 912.92ms for 110 items.
[Stats] Rate: 8.30 seconds per 1,000 items discovered.
[Test] Saved output to /Users/liorshtram/dev/dream-news/.worktrees/ingestion-pipeline-v1/tmp/stage1_output.json

 âœ“ src/lib/pipeline/stages/01_discovery.integration.test.ts (1 test) 918ms
   âœ“ Stage 1: Bulk Discovery (Integration) > should fetch real items from multiple RSS feeds 917ms

 Test Files  1 passed (1)
      Tests  1 passed (1)
   Start at  13:12:08
   Duration  1.57s (transform 47ms, setup 0ms, collect 372ms, tests 918ms, environment 0ms, prepare 27ms)

[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m

 RUN  v2.1.9 /Users/liorshtram/dev/dream-news/.worktrees/ingestion-pipeline-v1

1:12:10 PM [vite] warning: Duplicate key "ingestion" in object literal
45 |        ingestion: { lookbackHours: 24, maxItems: 100 },
46 |        discovery: { maxItemsPerSource: 50, searchWindowHours: 24 },
47 |        ingestion: { lookbackHours: 24, maxItems: 100 },
   |        ^
48 |        triage: { noiseThreshold: 0.3, minInterestScore: 60, maxHydrationLimit: 40 },
49 |        clustering: { algorithm: 'dbscan', epsilon: 0.85, minClusterSize: 2 },

  Plugin: vite:esbuild
  File: /Users/liorshtram/dev/dream-news/.worktrees/ingestion-pipeline-v1/src/lib/pipeline/stages/02_deduplication.integration.test.ts
 âœ“ src/lib/pipeline/stages/02_deduplication.integration.test.ts (1 test) 2ms
stdout | src/lib/pipeline/stages/02_deduplication.integration.test.ts > Stage 2: Precision Deduplication (Integration) > should handle real data with manual duplicates and history checks
[Test] Loaded 110 real items from Stage 1.
[Test] Running Deduplication on 120 items (10 intentional duplicates)...
[Stats] Pass 1: 0.11ms for 120 items.
[Stats] Rate: 0.88ms per 1,000 units.
[Test] Running Second Pass (History check)...
[Stats] Pass 2: 0.02ms. Should be 0 results.


 Test Files  1 passed (1)
      Tests  1 passed (1)
   Start at  13:12:10
   Duration  346ms (transform 34ms, setup 0ms, collect 31ms, tests 2ms, environment 0ms, prepare 37ms)

[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m

 RUN  v2.1.9 /Users/liorshtram/dev/dream-news/.worktrees/ingestion-pipeline-v1

stdout | src/lib/pipeline/stages/03_noise_filter.integration.test.ts > Stage 3: Noise Filtering (Integration) > should filter real data and correctly identify injected noise
[Test] Running Noise Filter on 113 items (3 intentional noise items)...
[Stats] Performance: 0.14ms for 113 items.
[Stats] Rate: 1.26ms per 1,000 units.
[Test] Saved clean output to /Users/liorshtram/dev/dream-news/.worktrees/ingestion-pipeline-v1/tmp/stage3_output.json

 âœ“ src/lib/pipeline/stages/03_noise_filter.integration.test.ts (1 test) 3ms

 Test Files  1 passed (1)
      Tests  1 passed (1)
   Start at  13:12:10
   Duration  333ms (transform 21ms, setup 0ms, collect 18ms, tests 3ms, environment 0ms, prepare 36ms)

[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m

 RUN  v2.1.9 /Users/liorshtram/dev/dream-news/.worktrees/ingestion-pipeline-v1

stdout | src/lib/pipeline/stages/04_triage.integration.test.ts > Stage 4: Intelligent Triage (Integration) > should rank items and enforce hydration limits on real data
[Test] Using Mock Brain for Triage.
[Test] Running Triage on 110 filtered items...
[Stats] Performance: 0.40ms for 110 items.
[Stats] Rate: 3.67ms per 1,000 units.
[Test] Saved top items to /Users/liorshtram/dev/dream-news/.worktrees/ingestion-pipeline-v1/tmp/stage4_output.json

 âœ“ src/lib/pipeline/stages/04_triage.integration.test.ts (1 test) 3ms

 Test Files  1 passed (1)
      Tests  1 passed (1)
   Start at  13:12:11
   Duration  354ms (transform 33ms, setup 0ms, collect 36ms, tests 3ms, environment 0ms, prepare 31ms)

[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m

 RUN  v2.1.9 /Users/liorshtram/dev/dream-news/.worktrees/ingestion-pipeline-v1

stdout | src/lib/pipeline/stages/05_hydration.integration.test.ts > Stage 5: High-Fidelity Hydration (Integration) > should scrape full content from real discovered URLs
[Test] Running Hydration on 5 top items...
[Hydrate] Content thin/snippet for "The Holy Grail of Linux Binary Compatibility: Musl and Dlopen". Triggering high-fidelity scrape...
[Hydrate] Content thin/snippet for "The browser is the sandbox". Triggering high-fidelity scrape...
[Hydrate] Content thin/snippet for "MapLibre Tile: a modern and efficient vector tile format". Triggering high-fidelity scrape...
[Hydrate] Content thin/snippet for "Things I've learned in my 10 years as an engineering manager". Triggering high-fidelity scrape...
[Hydrate] Content thin/snippet for "First, make me care". Triggering high-fidelity scrape...

 âœ“ src/lib/pipeline/stages/05_hydration.integration.test.ts (1 test) 566ms
   âœ“ Stage 5: High-Fidelity Hydration (Integration) > should scrape full content from real discovered URLs 566ms
stdout | src/lib/pipeline/stages/05_hydration.integration.test.ts > Stage 5: High-Fidelity Hydration (Integration) > should scrape full content from real discovered URLs
[Stats] Performance: 563.98ms for 5 items.
[Stats] Rate: 112796.68ms per 1,000 units.
[Test] Saved hydrated items to /Users/liorshtram/dev/dream-news/.worktrees/ingestion-pipeline-v1/tmp/stage5_output.json


 Test Files  1 passed (1)
      Tests  1 passed (1)
   Start at  13:12:12
   Duration  1.17s (transform 50ms, setup 0ms, collect 268ms, tests 566ms, environment 0ms, prepare 74ms)

[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m

 RUN  v2.1.9 /Users/liorshtram/dev/dream-news/.worktrees/ingestion-pipeline-v1

 âœ“ src/lib/pipeline/stages/06_embedding.integration.test.ts (1 test) 4ms
stdout | src/lib/pipeline/stages/06_embedding.integration.test.ts > Stage 6: Semantic Embedding (Integration) > should generate embeddings for real hydrated items
[Test] Using Mock Brain for Embedding.
[Test] Running Embedding on 5 items...
[Stats] Performance: 0.69ms for 5 items.
[Stats] Rate: 137.03ms per 1,000 units.
[Test] Saved embedded items to /Users/liorshtram/dev/dream-news/.worktrees/ingestion-pipeline-v1/tmp/stage6_output.json


 Test Files  1 passed (1)
      Tests  1 passed (1)
   Start at  13:12:13
   Duration  363ms (transform 40ms, setup 0ms, collect 43ms, tests 4ms, environment 0ms, prepare 61ms)

[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m

 RUN  v2.1.9 /Users/liorshtram/dev/dream-news/.worktrees/ingestion-pipeline-v1

1:12:15 PM [vite] warning: Duplicate key "ingestion" in object literal
25 |        ingestion: { lookbackHours: 24, maxItems: 100 },
26 |        discovery: { maxItemsPerSource: 50, searchWindowHours: 24 },
27 |        ingestion: { lookbackHours: 24, maxItems: 100 },
   |        ^
28 |        triage: { noiseThreshold: 0.3, minInterestScore: 60, maxHydrationLimit: 40 },
29 |        clustering: { algorithm: 'dbscan', epsilon: 0.85, minClusterSize: 2 },

  Plugin: vite:esbuild
  File: /Users/liorshtram/dev/dream-news/.worktrees/ingestion-pipeline-v1/src/lib/pipeline/stages/07_semantic_deduplication.integration.test.ts
 âœ“ src/lib/pipeline/stages/07_semantic_deduplication.integration.test.ts (1 test) 5ms
stdout | src/lib/pipeline/stages/07_semantic_deduplication.integration.test.ts > Stage 7: Near-Duplicate Resolution (Integration) > should identify and resolve near-duplicates using semantic similarity
[Test] Running Near-Dedupe on 7 items (2 intentional semantic duplicates)...
[Stats] Performance: 0.89ms for 7 items.
[Stats] Rate: 127.61ms per 1,000 units.
[Test] Result length: 5, Original length: 5
[Test] Saved deduplicated items to /Users/liorshtram/dev/dream-news/.worktrees/ingestion-pipeline-v1/tmp/stage7_output.json


 Test Files  1 passed (1)
      Tests  1 passed (1)
   Start at  13:12:14
   Duration  362ms (transform 62ms, setup 0ms, collect 49ms, tests 5ms, environment 0ms, prepare 60ms)

[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m

 RUN  v2.1.9 /Users/liorshtram/dev/dream-news/.worktrees/ingestion-pipeline-v1

stdout | src/lib/pipeline/stages/08_clustering.integration.test.ts > Stage 8: Semantic Clustering (Integration) > should group real embedded items into clusters
[Test] Running Clustering on 5 embedded items...
[Stats] Performance: 0.40ms for 5 items.
[Stats] Rate: 80.67ms per 1,000 units.
[Test] Saved clusters to /Users/liorshtram/dev/dream-news/.worktrees/ingestion-pipeline-v1/tmp/stage8_output.json

 âœ“ src/lib/pipeline/stages/08_clustering.integration.test.ts (1 test) 6ms

 Test Files  1 passed (1)
      Tests  1 passed (1)
   Start at  13:12:15
   Duration  358ms (transform 20ms, setup 0ms, collect 20ms, tests 6ms, environment 0ms, prepare 36ms)

[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m

 RUN  v2.1.9 /Users/liorshtram/dev/dream-news/.worktrees/ingestion-pipeline-v1

stdout | src/lib/pipeline/stages/09_synthesis.integration.test.ts > Stage 9: Narrative Synthesis (Integration) > should generate narratives for clusters using mock brain
[Test] Running Synthesis on 5 clusters...
[Stats] Performance: 0.60ms for 5 clusters.
[Stats] Rate: 120.38ms per 1,000 units.
[Test] Saved synthesized clusters to /Users/liorshtram/dev/dream-news/.worktrees/ingestion-pipeline-v1/tmp/stage9_output.json

 âœ“ src/lib/pipeline/stages/09_synthesis.integration.test.ts (1 test) 7ms

 Test Files  1 passed (1)
      Tests  1 passed (1)
   Start at  13:12:16
   Duration  363ms (transform 34ms, setup 0ms, collect 39ms, tests 7ms, environment 0ms, prepare 40ms)

[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m

 RUN  v2.1.9 /Users/liorshtram/dev/dream-news/.worktrees/ingestion-pipeline-v1

stdout | src/lib/pipeline/stages/10_scoring.integration.test.ts > Stage 10: Scoring & Ranking (Integration) > should rank clusters and apply temporal decay
[Test] Running Scoring on 5 clusters...
[Stats] Performance: 0.09ms for 5 clusters.
[Stats] Rate: 17.41ms per 1,000 units.
[Test] Saved ranked clusters to /Users/liorshtram/dev/dream-news/.worktrees/ingestion-pipeline-v1/tmp/stage10_output.json

 âœ“ src/lib/pipeline/stages/10_scoring.integration.test.ts (1 test) 7ms

 Test Files  1 passed (1)
      Tests  1 passed (1)
   Start at  13:12:17
   Duration  339ms (transform 25ms, setup 0ms, collect 20ms, tests 7ms, environment 0ms, prepare 51ms)

[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m

 RUN  v2.1.9 /Users/liorshtram/dev/dream-news/.worktrees/ingestion-pipeline-v1

stdout | src/lib/pipeline/stages/11_persistence.integration.test.ts > Stage 11: Persistence (Integration) > should persist final ranked clusters to the repository
[Test] Running Persistence on 5 clusters...
[Stats] Performance: 0.08ms for 5 clusters.
[Stats] Rate: 16.07ms per 1,000 units.

 âœ“ src/lib/pipeline/stages/11_persistence.integration.test.ts (1 test) 4ms

 Test Files  1 passed (1)
      Tests  1 passed (1)
   Start at  13:12:17
   Duration  337ms (transform 28ms, setup 0ms, collect 20ms, tests 4ms, environment 0ms, prepare 61ms)

